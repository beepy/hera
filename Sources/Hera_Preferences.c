/******************************************\|**| Hera_Preferences.c\******************************************/#pragma mark ¥¥INCLUDES¥¥/******************************************\|**| #includes\******************************************/#pragma mark _system includes_/* - system*******************************************/#pragma mark _third party includes_/* - third party libraries*******************************************/#pragma mark _bp libraries includes_/* - bp libraries*******************************************/#include "Assert.h"#include "Alt Preferences.h"#include "StdPrefsLib.h"#pragma mark _this library includes_/* - this project*******************************************/#include "Hera_Global.h"#include "Hera_Preferences.h"#include "Technote.h"#pragma mark ¥¥DEFINITIONS¥¥/******************************************\|**| #defines\******************************************//* - definitions*******************************************/#define	kAresDataFolder_Name			"\pAres Data Ä"#define	kAresSoundsFile_Name			"\pAres Sounds"#define	kAresSpritesFile_Name			"\pAres Sprites"#define	kAresInterfacesFile_Name		"\pAres Interfaces"#define	kAresScenariosFile_Name			"\pAres Scenarios"#pragma mark _macros_/* - macros*******************************************/#pragma mark ¥¥TYPEDEFS¥¥/******************************************\|**| typedefs\******************************************/#pragma mark ¥¥EXTERNAL GLOBALS¥¥/******************************************\|**| external globals\******************************************/extern heraGlobalType *gHera;#pragma mark ¥¥PRIVATE GLOBALS¥¥/******************************************\|**| private globals\******************************************/#pragma mark ¥¥PRIVATE PROTOTYPES¥¥/******************************************\|**| private function prototypes\******************************************/OSErr	AresLocation_Save_alis( AliasHandle	aresFolderAlias);#pragma mark ¥¥PRIVATE FUNCTIONS¥¥/******************************************\|**| private functions\******************************************/OSErr	AresLocation_Save_alis( AliasHandle	aresFolderAlias){	OSErr	error;	short		resID = kAresFolder_alis_ResID;	if ( aresFolderAlias == nil) return paramErr;	error = WritePreference( gHera->prefRefNum, 'alis', &resID, nil,		(Handle)aresFolderAlias);	return error;	}#pragma mark ¥¥PUBLIC FUNCTIONS¥¥/******************************************\|**| public functions\******************************************//* HP_AresDefaultData_Open	Opens the resource files located in the Ares Data folder located in the Ares	folder.*/OSErr HP_AresDefaultData_Open( Boolean *fatal){	AliasHandle	aresFolderAlias = nil;	OSErr		error;	short		resID = kAresFolder_alis_ResID;	FSSpec		aresFolder, aresDataFolder, aresDataFile;	Boolean		wasChanged;	long		dirID;		*fatal = false;	error = ReadPreference( gHera->prefRefNum, 'alis', &resID, nil,		(Handle *)&aresFolderAlias);		if ( error != noErr)	{		*fatal = true;		return error;	}	if ( aresFolderAlias == nil) return resNotFound;		error = ResolveAlias( nil, aresFolderAlias, &aresFolder, &wasChanged);	if ( error != noErr) return error;	if ( wasChanged)	{		error = AresLocation_Save_alis( aresFolderAlias);		if ( error != noErr)		{			*fatal = true;			return error;		}	}		// get the data folder fsspec	error = TNGetDirID( &aresFolder, &dirID);	if ( error != noErr)	{		*fatal = true;		return error;	}		error = FSMakeFSSpec( aresFolder.vRefNum, dirID,		kAresDataFolder_Name, &aresDataFolder);		if ( error != noErr)	{		if ( error != fnfErr) *fatal = true;		return error;	}		// prepare to open the data files	error = TNGetDirID( &aresDataFolder, &dirID);	if ( error != noErr)	{		*fatal = true;		return error;	}		// open the sounds file	error = FSMakeFSSpec( aresDataFolder.vRefNum, dirID,		kAresSoundsFile_Name, &aresDataFile);		if ( error != noErr)	{		if ( error != fnfErr) *fatal = true;		return error;	}	//	error = FSpOpenRF( &aresDataFile, fsRdPerm,//		&gHera->default_soundFile_refNum);	gHera->default_soundFile_refNum = FSpOpenResFile( &aresDataFile,		fsRdPerm);	error = ResError();	if ( error != noErr)	{		if ( error != fnfErr) *fatal = true;		return error;	}		// open the scenario file	error = FSMakeFSSpec( aresDataFolder.vRefNum, dirID,		kAresScenariosFile_Name, &aresDataFile);		if ( error != noErr)	{		if ( error != fnfErr) *fatal = true;		return error;	}	//	error = FSpOpenRF( &aresDataFile, fsRdPerm,//		&gHera->default_scenarioFile_refNum);	gHera->default_scenarioFile_refNum = FSpOpenResFile( &aresDataFile,		fsRdPerm);		error = ResError();	if ( error != noErr)	{		if ( error != fnfErr) *fatal = true;		return error;	}		mAssert( gHera->default_scenarioFile_refNum > 0);		// open the interface file	error = FSMakeFSSpec( aresDataFolder.vRefNum, dirID,		kAresInterfacesFile_Name, &aresDataFile);		if ( error != noErr)	{		if ( error != fnfErr) *fatal = true;		return error;	}	//	error = FSpOpenRF( &aresDataFile, fsRdPerm,//		&gHera->default_interfaceFile_refNum);	gHera->default_interfaceFile_refNum = FSpOpenResFile( &aresDataFile,		fsRdPerm);	error = ResError();	if ( error != noErr)	{		if ( error != fnfErr) *fatal = true;		return error;	}		// open the sprite file	error = FSMakeFSSpec( aresDataFolder.vRefNum, dirID,		kAresSpritesFile_Name, &aresDataFile);		if ( error != noErr)	{		if ( error != fnfErr) *fatal = true;		return error;	}	//	error = FSpOpenRF( &aresDataFile, fsRdPerm,//		&gHera->default_spriteFile_refNum);	gHera->default_spriteFile_refNum = FSpOpenResFile( &aresDataFile,		fsRdPerm);	error = ResError();	if ( error != noErr)	{		if ( error != fnfErr) *fatal = true;		return error;	}		gHera->userPrefs.firstLaunch = nil;	return noErr;}/* HP_AresLocation_Save		Saves the location of the Ares folder in the preferences file.*/OSErr HP_AresLocation_Save( FSSpecPtr aresFolder){	OSErr		error;	AliasHandle	aresFolderAlias = nil;		if ( aresFolder == nil) return paramErr;		error = NewAlias( nil, aresFolder, &aresFolderAlias);	if ( error != noErr) return error;		error = AresLocation_Save_alis( aresFolderAlias);	DisposeHandle( (Handle)aresFolderAlias);	return error;}