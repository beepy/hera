/******************************************\|**| PsuedoColumn_Utilities.c\******************************************/#pragma mark 본INCLUDES본/******************************************\|**| #includes\******************************************/#pragma mark _system includes_/* - system*******************************************/#include <stdarg.h>#pragma mark _third party includes_/* - third party libraries*******************************************/#pragma mark _bp libraries includes_/* - bp libraries*******************************************/#include "Assert.h"#include "List_Utilities.h"#pragma mark _this library includes_/* - this project*******************************************/#include "PsuedoColumn_Utilities.h"#pragma mark 본DEFINITIONS본/******************************************\|**| #defines\******************************************//* - definitions*******************************************/#pragma mark _macros_/* - macros*******************************************/#pragma mark 본TYPEDEFS본/******************************************\|**| typedefs\******************************************/#pragma mark 본EXTERNAL GLOBALS본/******************************************\|**| external globals\******************************************/#pragma mark 본PRIVATE GLOBALS본/******************************************\|**| private globals\******************************************/#pragma mark 본PRIVATE PROTOTYPES본/******************************************\|**| private function prototypes\******************************************/#pragma mark 본PRIVATE FUNCTIONS본/******************************************\|**| private functions\******************************************/#pragma mark 본PUBLIC FUNCTIONS본/******************************************\|**| public functions\******************************************/Ptr PsuedoColumn_Data_Make( long *length, const long index,	const StringPtr sourceString, ...){	va_list				ap = 0;	long				totalLength = 4, i, *l;	Ptr					result = nil;	char				*c;	StringPtr			oneString;		*length = 4;	// first get the total length of all the strings combined	va_start( ap, sourceString);			oneString = sourceString;	while (oneString[0] != 0)	{				totalLength += oneString[0];		oneString = va_arg( ap, StringPtr);	}		va_end( ap);		// reserve space big enough for all strings	result = NewPtr( totalLength);	if ( result == nil) return nil;		c = result;		l = (long *)c;	*l = index;	c += 4;		ap = 0;		// copy each string (but not pstring length byte)	va_start( ap, sourceString);	oneString = sourceString;	while (oneString[0] != 0)	{				i = 1;		while ( i <= oneString[0])		{			*c = oneString[i];			c++;			i++;			*length = *length + 1;		}				oneString = va_arg( ap, StringPtr);	}		va_end( ap);	return result;	}void PsuedoColumn_String_GetAll( char *source, long length,	long *index, StringPtr destString, ...){	va_list				ap = 0;	char				*c;	StringPtr			oneString;			mAssert( source != nil);		c = source;		if ( index != nil)	{		*index = *((long *)c);	}	c += 4;	length -= 4;	va_start( ap, destString);	oneString = destString;		while (( length > 0) && ( oneString != (StringPtr)-1))	{		if ( oneString != nil)			oneString[0] = 0;		while (( *c != '\t') && ( length > 0))		{			if ( oneString != nil)			{				oneString[0] = oneString[0] + 1;				oneString[oneString[0]] = *c;			}			c++;			length--;		}				if ( *c == '\t')		{			c++;			length--;		}		oneString = va_arg( ap, StringPtr);	}		va_end( ap);	}void PsuedoColumn_List_ChangeIndex( ListHandle list, const long rowNum,	const long index){	Ptr		data;	long	*lp;	short	length;		if ( list == nil) return;	data = List_Utilities_GetCell( list, (Point){rowNum, 0}, &length);	if ( data == nil) return;	lp = (long *)data;	*lp = index;	LSetCell( data, length, (Point){rowNum, 0}, list);	DisposePtr( data);}long PsuedoColumn_List_GetIndex( ListHandle list, const long rowNum){	Ptr		data;	long	*lp, result;	short	length;		if ( list == nil) return -1;	data = List_Utilities_GetCell( list, (Point){rowNum, 0}, &length);	if ( data == nil) return -1;	lp = (long *)data;	result = *lp;	DisposePtr( data);	return result;}StringPtr PsuedoColumn_String_GetFromNthColumn( Ptr data, long dataLength, StringPtr s,	long colNum){	char	*c = data;		s[0] = 0;	if ( data == nil) return s;		c += 4;			// skip over "index" (arbitrary reference number)	dataLength -= 4;		while (( dataLength > 0) && ( colNum != 0))	{		// skip to the next tab		while (( dataLength > 0) && ( *c != '\t'))		{			dataLength--;			c++;		}		colNum--;	}	if ( *c == '\t')	{		c++;		dataLength--;	}		while (( dataLength > 0) && ( *c != '\t'))	{		s[0] = s[0] + 1;		s[s[0]] = *c;		c++;		dataLength--;	}	return s;}/* PsuedoColumn_CellV_FindFromNumber	for looking up a cell entry by the numeric value stored in one of the	psuedo columns (in string format)*/short PsuedoColumn_CellV_FindFromNumber( ListHandle list, const long colNum,	const long value){	short		dataLength, result = 0;	Ptr			data;	long		i, cellValue;	Str255		s;		if ( list == nil) return -1;		i = 0;	while ( i < (**list).dataBounds.bottom)	{		data = List_Utilities_GetCell( list, (Point){i, 0}, &dataLength);		if ( data != nil)		{			PsuedoColumn_String_GetFromNthColumn( data, dataLength, s, colNum);			DisposePtr( data);			StringToNum( s, &cellValue);			if ( cellValue == value) return i;		}		i++;	}	return -1;}/* PsuedoColumn_PString_CleanInPlace	this will replace any tabs, returns, or newlines in a string with	spaces, in place.*/	void PsuedoColumn_PString_CleanInPlace( StringPtr s){	long	i = 1;		if ( s == nil) return;	while ( i <= s[0])	{		if ((s[i] == '\r') || (s[i] == '\n') || (s[i] == '\t'))			s[i] = 0;		i++;	}}